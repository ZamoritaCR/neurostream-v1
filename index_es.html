<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dopamine.watch - Domina Tu Dopamina | Gu√≠a de Streaming para TDAH</title>
<meta name="description" content="La primera gu√≠a de streaming dise√±ada para cerebros con TDAH y neurodivergentes. Pel√≠culas, m√∫sica, podcasts y m√°s sincronizados con tu estado de √°nimo.">
<link rel="icon" href="favicon.ico" type="image/x-icon">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-34Q0KMXDQF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-34Q0KMXDQF');
</script>

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ============================================
   ADHD-OPTIMIZED COLORS (Research-Backed)
   ============================================ */
:root {
    --bg-primary: #0f0f14;
    --bg-secondary: #16161d;
    --accent-primary: #7c3aed;
    --accent-secondary: #06b6d4;
    --accent-tertiary: #10b981;
    --text-primary: #f5f5f7;
    --text-secondary: rgba(245, 245, 247, 0.7);
    --glass-border: rgba(255, 255, 255, 0.12);
}

/* ============ RESET & BASE ============ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: 'Inter', system-ui, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
}

a {
    color: inherit;
    text-decoration: none;
}

/* ============ BACKGROUND EFFECTS ============ */
.bg-gradient {
    position: fixed;
    inset: 0;
    background:
        radial-gradient(ellipse at 20% 20%, rgba(124, 58, 237, 0.12) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(124, 58, 237, 0.06) 0%, transparent 60%);
    z-index: -2;
}

.bg-grid {
    position: fixed;
    inset: 0;
    background-image:
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    z-index: -1;
}

@media (prefers-reduced-motion: reduce) {
    html { scroll-behavior: auto; }
}

/* ============ NAVIGATION ============ */
nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(15, 15, 20, 0.8);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--glass-border);
}

.nav-logo {
    font-size: 1.4rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 10px;
}

.nav-logo .icon {
    font-size: 1.6rem;
}

.nav-logo .gradient {
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.nav-links {
    display: flex;
    align-items: center;
    gap: 30px;
}

.nav-links a {
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
    transition: color 0.2s;
}

.nav-links a:hover {
    color: var(--text-primary);
}

/* Language Switcher */
.lang-switch {
    display: flex;
    gap: 0.25rem;
    padding: 0.2rem;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    border: 1px solid var(--glass-border);
    margin-right: 8px;
}
.lang-switch a {
    padding: 0.35rem 0.6rem;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 500;
    transition: all 0.2s;
    text-decoration: none;
    color: var(--text-secondary);
}
.lang-switch a.active {
    background: var(--accent-primary);
    color: white;
}
.lang-switch a:hover:not(.active) {
    background: rgba(255,255,255,0.1);
}

.nav-btn {
    padding: 10px 24px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.nav-btn.secondary {
    background: transparent;
    color: var(--text-primary);
    border: 1px solid var(--glass-border);
}

.nav-btn.primary {
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
    color: white;
}

.nav-btn:hover {
    transform: translateY(-2px);
}

/* ============ HERO SECTION ============ */
.hero {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 120px 20px 80px;
}

.hero-content {
    max-width: 900px;
}

.hero-badge {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(124, 58, 237, 0.15);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 30px;
    font-size: 0.85rem;
    color: var(--accent-primary);
    margin-bottom: 30px;
}

.hero h1 {
    font-size: 4rem;
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 24px;
}

.hero h1 .gradient {
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary), #a78bfa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.hero p {
    font-size: 1.3rem;
    color: var(--text-secondary);
    max-width: 650px;
    margin: 0 auto 24px;
}

.hero-trust {
    display: flex;
    justify-content: center;
    gap: 24px;
    flex-wrap: wrap;
    margin-bottom: 32px;
}

.trust-item {
    font-size: 0.9rem;
    color: var(--accent-tertiary);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
}

.hero-buttons {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
}

.hero-btn {
    padding: 16px 32px;
    border-radius: 14px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
}

.hero-btn.primary {
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary), #a78bfa);
    color: white;
    box-shadow: 0 10px 40px rgba(124, 58, 237, 0.3);
}

.hero-btn.primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 50px rgba(124, 58, 237, 0.4);
}

.hero-btn.primary {
    animation: ctaPulse 2s ease-in-out infinite;
}

@keyframes ctaPulse {
    0%, 100% { box-shadow: 0 10px 40px rgba(124, 58, 237, 0.3); }
    50% { box-shadow: 0 10px 50px rgba(124, 58, 237, 0.5); }
}

.hero-btn.secondary {
    background: rgba(255,255,255,0.05);
    color: var(--text-primary);
    border: 1px solid var(--glass-border);
}

.hero-btn.secondary:hover {
    background: rgba(255,255,255,0.08);
}

.hero-stats {
    display: flex;
    justify-content: center;
    gap: 60px;
    margin-top: 60px;
    padding-top: 40px;
    border-top: 1px solid var(--glass-border);
}

.stat {
    text-align: center;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 4px;
}

/* ============ FEATURES SECTION ============ */
.features {
    padding: 100px 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.section-header {
    text-align: center;
    margin-bottom: 60px;
}

.section-tag {
    display: inline-block;
    padding: 6px 14px;
    background: rgba(6, 182, 212, 0.15);
    border-radius: 20px;
    font-size: 0.8rem;
    color: var(--accent-secondary);
    font-weight: 600;
    margin-bottom: 16px;
}

.section-header h2 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 16px;
}

.section-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
}

.feature-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 32px;
    transition: all 0.3s;
}

.feature-card:hover {
    background: rgba(255,255,255,0.05);
    border-color: rgba(124, 58, 237, 0.3);
    transform: translateY(-4px);
}

.feature-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(6, 182, 212, 0.2));
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    margin-bottom: 20px;
}

.feature-card h3 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 12px;
}

.feature-card p {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.6;
}

/* ============ HOW IT WORKS ============ */
.how-it-works {
    padding: 100px 20px;
    background: rgba(255,255,255,0.02);
}

.how-it-works .container {
    max-width: 1000px;
    margin: 0 auto;
}

.steps {
    display: flex;
    flex-direction: column;
    gap: 40px;
    margin-top: 60px;
}

.step {
    display: flex;
    align-items: center;
    gap: 40px;
}

.step:nth-child(even) {
    flex-direction: row-reverse;
}

.step-number {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 800;
    flex-shrink: 0;
}

.step-content h3 {
    font-size: 1.4rem;
    margin-bottom: 10px;
}

.step-content p {
    color: var(--text-secondary);
    font-size: 1rem;
}

/* ============ TESTIMONIALS ============ */
.testimonials {
    padding: 100px 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.testimonials-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 24px;
}

.testimonial-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 32px;
}

.testimonial-text {
    font-size: 1.05rem;
    line-height: 1.7;
    color: #ccc;
    margin-bottom: 24px;
}

.testimonial-author {
    display: flex;
    align-items: center;
    gap: 14px;
}

.author-avatar {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: 700;
}

.author-info h4 {
    font-size: 1rem;
    font-weight: 600;
}

.author-info p {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* ============ DOWNLOAD APP ============ */
.download-app {
    padding: 100px 20px;
    background: linear-gradient(180deg, rgba(139,92,246,0.05) 0%, transparent 100%);
}

.download-app .container {
    max-width: 1000px;
    margin: 0 auto;
}

.download-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
    margin-top: 60px;
}

@media (max-width: 768px) {
    .download-grid {
        grid-template-columns: 1fr;
    }
}

.download-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 32px;
    text-align: center;
    transition: transform 0.3s, border-color 0.3s;
}

.download-card:hover {
    transform: translateY(-4px);
    border-color: var(--accent-primary);
}

.download-icon {
    font-size: 3rem;
    margin-bottom: 16px;
}

.download-card h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: var(--text-primary);
}

.download-steps {
    text-align: left;
    padding-left: 20px;
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.8;
}

.download-steps li {
    margin-bottom: 8px;
}

.download-steps strong {
    color: var(--text-primary);
}

/* ============ PRICING ============ */
.pricing {
    padding: 100px 20px;
    background: rgba(255,255,255,0.02);
}

.pricing .container {
    max-width: 1000px;
    margin: 0 auto;
}

.pricing-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-top: 60px;
}

.pricing-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--glass-border);
    border-radius: 24px;
    padding: 40px 32px;
    text-align: center;
    position: relative;
}

.pricing-card.featured {
    border-color: var(--accent-primary);
    box-shadow: 0 0 60px rgba(124, 58, 237, 0.2);
}

.pricing-badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    padding: 6px 16px;
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    color: white;
}

.pricing-card h3 {
    font-size: 1.3rem;
    margin-bottom: 8px;
}

.pricing-price {
    font-size: 3rem;
    font-weight: 800;
    margin: 16px 0;
}

.pricing-price span {
    font-size: 1rem;
    font-weight: 400;
    color: var(--text-secondary);
}

.pricing-features {
    text-align: left;
    margin: 30px 0;
}

.pricing-features li {
    list-style: none;
    padding: 10px 0;
    color: #aaa;
    display: flex;
    align-items: center;
    gap: 10px;
}

.pricing-features li::before {
    content: "‚úì";
    color: var(--accent-tertiary);
    font-weight: bold;
}

.pricing-btn {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
}

.pricing-btn.primary {
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
    color: white;
}

.pricing-btn.secondary {
    background: rgba(255,255,255,0.05);
    color: var(--text-primary);
}

/* ============ CTA SECTION ============ */
.cta {
    padding: 100px 20px;
    text-align: center;
}

.cta-box {
    max-width: 700px;
    margin: 0 auto;
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(6, 182, 212, 0.15));
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 30px;
    padding: 60px 40px;
}

.cta h2 {
    font-size: 2.2rem;
    margin-bottom: 16px;
}

.cta p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin-bottom: 30px;
}

/* ============ FOOTER ============ */
footer {
    padding: 60px 20px 30px;
    border-top: 1px solid var(--glass-border);
    text-align: center;
}

.footer-links {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.footer-links a {
    color: var(--text-secondary);
    font-size: 0.9rem;
    transition: color 0.2s;
}

.footer-links a:hover {
    color: var(--text-primary);
}

.footer-copy {
    color: #444;
    font-size: 0.85rem;
}

/* ============================================
   MR.DP FLOATING CHAT WIDGET
   ============================================ */
.mr-dp-container {
    position: fixed;
    top: 24px;
    right: 24px;
    z-index: 99999;
    pointer-events: none;
}

.mr-dp-container * {
    pointer-events: auto;
}

.mr-dp-avatar {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 50%, #10b981 100%);
    box-shadow: 0 8px 32px rgba(139, 92, 246, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    animation: mrDpBounce 4s ease-in-out infinite;
    position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.mr-dp-avatar:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 40px rgba(139, 92, 246, 0.6);
    animation: none;
}

.mr-dp-avatar svg {
    width: 48px !important;
    height: 48px !important;
}

@keyframes mrDpBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
}

@media (prefers-reduced-motion: reduce) {
    .mr-dp-avatar { animation: none !important; }
}

.mr-dp-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    min-width: 22px;
    height: 22px;
    background: #ef4444;
    color: white;
    font-size: 12px;
    font-weight: 700;
    border-radius: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 6px;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.5);
}

.mr-dp-popup {
    position: absolute;
    top: 80px;
    right: 0;
    width: 360px;
    max-height: 500px;
    background: rgba(13, 13, 20, 0.98);
    border: 1px solid rgba(139, 92, 246, 0.4);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
    overflow: hidden;
    display: none;
    flex-direction: column;
    backdrop-filter: blur(20px);
}

.mr-dp-popup.open {
    display: flex;
}

.mr-dp-header {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(6, 182, 212, 0.2));
    padding: 14px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(139, 92, 246, 0.25);
}

.mr-dp-header-img svg {
    width: 40px;
    height: 40px;
}

.mr-dp-header-name {
    font-weight: 700;
    font-size: 1rem;
    background: linear-gradient(135deg, #a78bfa, #06b6d4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.mr-dp-header-status {
    font-size: 0.75rem;
    color: var(--accent-tertiary);
}

.mr-dp-messages {
    padding: 16px;
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 320px;
}

.mr-dp-empty {
    text-align: center;
    padding: 30px 20px;
    color: rgba(255, 255, 255, 0.5);
}

.mr-dp-empty-icon {
    font-size: 2.5rem;
    margin-bottom: 12px;
}

.mr-dp-msg {
    padding: 12px 16px;
    border-radius: 18px;
    font-size: 0.9rem;
    line-height: 1.5;
    max-width: 85%;
    word-wrap: break-word;
}

.mr-dp-msg.user {
    background: linear-gradient(135deg, #8b5cf6, #06b6d4);
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 6px;
}

.mr-dp-msg.assistant {
    background: rgba(139, 92, 246, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.25);
    color: white;
    margin-right: auto;
    border-bottom-left-radius: 6px;
}

.mr-dp-input-area {
    padding: 12px 16px;
    background: rgba(139, 92, 246, 0.1);
    border-top: 1px solid rgba(139, 92, 246, 0.2);
    display: flex;
    gap: 8px;
}

.mr-dp-input {
    flex: 1;
    padding: 10px 14px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: white;
    font-size: 0.9rem;
    outline: none;
}

.mr-dp-input:focus {
    border-color: var(--accent-primary);
}

.mr-dp-input::placeholder {
    color: rgba(255, 255, 255, 0.3);
}

.mr-dp-send {
    padding: 10px 16px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s;
}

.mr-dp-send:hover {
    transform: scale(1.05);
}

.mr-dp-send:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* AUTH MODAL */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: 1000;
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.modal-overlay.active {
    display: flex;
}

.modal {
    background: #0a0a0f;
    border: 1px solid var(--glass-border);
    border-radius: 24px;
    padding: 40px;
    width: 100%;
    max-width: 420px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 36px;
    height: 36px;
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    background: rgba(255,255,255,0.2);
}

.auth-title {
    font-size: 1.6rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 8px;
}

.auth-subtitle {
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 28px;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    font-size: 0.85rem;
    color: #aaa;
    margin-bottom: 6px;
}

.form-group input {
    width: 100%;
    padding: 14px 16px;
    background: #1a1a1a;
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: white;
    font-size: 1rem;
    transition: all 0.2s;
}

.form-group input:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(124,58,237,0.2);
}

.auth-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
}

.auth-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(124,58,237,0.3);
}

.auth-btn.secondary {
    background: rgba(255,255,255,0.05);
    color: var(--text-primary);
    margin-top: 12px;
}

.auth-link {
    text-align: center;
    margin-top: 20px;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.auth-link a {
    color: var(--accent-secondary);
    cursor: pointer;
}

.auth-link a:hover {
    text-decoration: underline;
}

.auth-screen {
    display: none;
}

.auth-screen.active {
    display: block;
}

.auth-divider {
    display: flex;
    align-items: center;
    margin: 20px 0;
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.auth-divider::before,
.auth-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--glass-border);
}

.auth-divider span {
    padding: 0 16px;
}

.g_id_signin {
    margin-bottom: 8px;
}

/* ============ RESPONSIVE ============ */

/* Tablet */
@media (max-width: 1024px) {
    .hero h1 {
        font-size: 3rem;
    }

    .hero-stats {
        gap: 40px;
    }

    .features-grid,
    .testimonials-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Mobile */
@media (max-width: 768px) {
    /* Navigation */
    nav {
        padding: 12px 16px;
    }

    .nav-logo {
        font-size: 1.2rem;
    }

    .nav-logo .icon {
        font-size: 1.4rem;
    }

    .nav-links {
        gap: 8px;
    }

    .nav-links a:not(.nav-btn):not(.lang-switch a) {
        display: none;
    }

    .lang-switch {
        margin-right: 4px;
    }

    .nav-btn {
        padding: 8px 16px;
        font-size: 0.85rem;
    }

    .nav-btn.secondary {
        display: none;
    }

    /* Hero */
    .hero {
        padding: 100px 16px 60px;
        min-height: auto;
    }

    .hero-badge {
        font-size: 0.75rem;
        padding: 6px 12px;
        margin-bottom: 20px;
    }

    .hero h1 {
        font-size: 2rem;
        margin-bottom: 16px;
    }

    .hero p {
        font-size: 1rem;
        margin-bottom: 20px;
    }

    .hero-trust {
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
    }

    .trust-item {
        font-size: 0.85rem;
    }

    .hero-buttons {
        flex-direction: column;
        gap: 12px;
    }

    .hero-btn {
        width: 100%;
        padding: 14px 24px;
        font-size: 1rem;
    }

    .hero-stats {
        flex-direction: column;
        gap: 24px;
        margin-top: 40px;
        padding-top: 30px;
    }

    .stat-number {
        font-size: 2rem;
    }

    .stat-label {
        font-size: 0.85rem;
    }

    /* Sections */
    .features,
    .testimonials,
    .pricing,
    .how-it-works,
    .download-app,
    .cta {
        padding: 60px 16px;
    }

    .section-header {
        margin-bottom: 40px;
    }

    .section-tag {
        font-size: 0.75rem;
    }

    .section-header h2 {
        font-size: 1.75rem;
    }

    .section-header p {
        font-size: 1rem;
    }

    /* Features */
    .features-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }

    .feature-card {
        padding: 24px;
    }

    .feature-icon {
        width: 48px;
        height: 48px;
        font-size: 1.5rem;
    }

    .feature-card h3 {
        font-size: 1.1rem;
    }

    /* How It Works */
    .steps {
        gap: 30px;
        margin-top: 40px;
    }

    .step {
        flex-direction: column !important;
        text-align: center;
        gap: 20px;
    }

    .step-number {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }

    .step-content h3 {
        font-size: 1.2rem;
    }

    /* Testimonials */
    .testimonials-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }

    .testimonial-card {
        padding: 24px;
    }

    .testimonial-text {
        font-size: 1rem;
    }

    /* Pricing */
    .pricing-grid {
        grid-template-columns: 1fr !important;
        max-width: 400px !important;
        gap: 20px;
    }

    .pricing-card {
        padding: 30px 24px;
    }

    .pricing-price {
        font-size: 2.5rem;
    }

    .pricing-features li {
        font-size: 0.9rem;
    }

    /* CTA */
    .cta-box {
        padding: 40px 24px;
        border-radius: 20px;
    }

    .cta h2 {
        font-size: 1.5rem;
    }

    .cta p {
        font-size: 1rem;
    }

    /* Footer */
    footer {
        padding: 40px 16px 24px;
    }

    .footer-links {
        gap: 16px;
        flex-direction: column;
        align-items: center;
    }

    .footer-links span {
        display: none;
    }

    /* Mr.DP Widget */
    .mr-dp-container {
        top: auto;
        bottom: 16px;
        right: 16px;
    }

    .mr-dp-avatar {
        width: 56px;
        height: 56px;
    }

    .mr-dp-avatar svg {
        width: 40px !important;
        height: 40px !important;
    }

    .mr-dp-popup {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-height: 100%;
        border-radius: 0;
        z-index: 100000;
    }

    .mr-dp-messages {
        max-height: calc(100vh - 180px);
    }

    /* Auth Modal */
    .modal {
        max-width: 100%;
        max-height: 100%;
        border-radius: 0;
        padding: 30px 20px;
    }

    .auth-title {
        font-size: 1.4rem;
    }

    .form-group input {
        padding: 12px 14px;
    }

    .auth-btn {
        padding: 14px;
        font-size: 1rem;
    }
}

/* Small phones */
@media (max-width: 380px) {
    .hero h1 {
        font-size: 1.75rem;
    }

    .nav-btn.primary {
        padding: 8px 12px;
        font-size: 0.8rem;
    }

    .hero-btn {
        font-size: 0.95rem;
        padding: 12px 20px;
    }
}
</style>
</head>

<body>

<div class="bg-gradient"></div>
<div class="bg-grid"></div>

<!-- ============ NAVIGATION ============ -->
<nav>
    <div class="nav-logo">
        <span class="icon">üß†</span>
        <span>Dopamine<span class="gradient">.watch</span></span>
    </div>
    <div class="nav-links">
        <a href="#features">Funciones</a>
        <a href="#how-it-works">C√≥mo Funciona</a>
        <a href="#download">Descargar</a>
        <a href="#pricing">Precios</a>
        <div class="lang-switch">
            <a href="https://www.dopamine.watch/index.html">üá∫üá∏</a>
            <a href="https://www.dopamine.watch/index_es.html" class="active">üá™üá∏</a>
        </div>
        <button class="nav-btn secondary" onclick="openModal('login')">Entrar</button>
        <button class="nav-btn primary" onclick="openModal('signup')">Comenzar</button>
    </div>
</nav>

<!-- ============ HERO ============ -->
<section class="hero">
    <div class="hero-content">
        <div class="hero-badge">üî¨ Respaldado por +45 A√±os de Investigaci√≥n en TDAH y Neurociencia</div>
        <h1>Deja de scrollear.<br>Empieza a <span class="gradient">dominar tu dopamina.</span></h1>
        <p>Contenido como medicina. Basado en d√©cadas de investigaci√≥n sobre c√≥mo los cerebros con TDAH procesan la dopamina, la recompensa y la atenci√≥n. Dinos c√≥mo te sientes ‚Äî encontramos el contenido perfecto en segundos.</p>

        <div class="hero-trust">
            <span class="trust-item">‚úì Sincronizaci√≥n cient√≠fica de √°nimo</span>
            <span class="trust-item">‚úì Cero fatiga de decisi√≥n</span>
            <span class="trust-item">‚úì Recomendaciones instant√°neas</span>
        </div>

        <div class="hero-buttons">
            <button class="hero-btn primary" onclick="openModal('signup')">üöÄ Comenzar Gratis ‚Äî Sin Tarjeta</button>
            <button class="hero-btn secondary" onclick="openModal('login')">üîê Iniciar Sesi√≥n</button>
        </div>

        <div class="hero-stats">
            <div class="stat">
                <div class="stat-number">500+</div>
                <div class="stat-label">Usuarios Activos</div>
            </div>
            <div class="stat">
                <div class="stat-number">+50K</div>
                <div class="stat-label">Contenido Curado</div>
            </div>
            <div class="stat">
                <div class="stat-number">12</div>
                <div class="stat-label">Estados de √Ånimo</div>
            </div>
            <div class="stat">
                <div class="stat-number">4.9</div>
                <div class="stat-label">Calificaci√≥n</div>
            </div>
        </div>
    </div>
</section>

<!-- ============ FEATURES ============ -->
<section class="features" id="features">
    <div class="section-header">
        <div class="section-tag">FUNCIONES</div>
        <h2>¬øPor Qu√© Dopamine.watch?</h2>
        <p>Entendemos la fatiga de decisi√≥n. Por eso creamos algo diferente.</p>
    </div>

    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">üéØ</div>
            <h3>Descubrimiento por √Ånimo</h3>
            <p>Dinos c√≥mo te sientes AHORA y c√≥mo QUIERES sentirte. Nuestro algoritmo encuentra el contenido perfecto para cerrar esa brecha.</p>
        </div>

        <div class="feature-card">
            <div class="feature-icon">üß†</div>
            <h3>Mr.DP - Curador con IA</h3>
            <p>¬°Conoce a tu amigo personal de dopamina! Solo cu√©ntale lo que tienes en mente y √©l encontrar√° exactamente lo que necesitas.</p>
        </div>

        <div class="feature-card">
            <div class="feature-icon">‚ö°</div>
            <h3>Chute R√°pido</h3>
            <p>¬øNo puedes decidir? Un bot√≥n te da la combinaci√≥n perfecta al instante. Sin scrollear necesario.</p>
        </div>

        <div class="feature-card">
            <div class="feature-icon">üé¨</div>
            <h3>Pel√≠culas y Series</h3>
            <p>Recomendaciones filtradas por emoci√≥n de Netflix, Disney+, Max, y m√°s de 20 servicios de streaming.</p>
        </div>

        <div class="feature-card">
            <div class="feature-icon">üéµ</div>
            <h3>M√∫sica y Playlists</h3>
            <p>M√∫sica sincronizada con tu √°nimo de Spotify y Apple Music. Vibras perfectas, siempre.</p>
        </div>

        <div class="feature-card">
            <div class="feature-icon">üéôÔ∏è</div>
            <h3>Podcasts y Audiolibros</h3>
            <p>Podcasts y audiolibros curados seg√∫n tu estado mental actual y tus intereses.</p>
        </div>
    </div>
</section>

<!-- ============ HOW IT WORKS ============ -->
<section class="how-it-works" id="how-it-works">
    <div class="container">
        <div class="section-header">
            <div class="section-tag">C√ìMO FUNCIONA</div>
            <h2>3 Pasos Hacia la Dopamina</h2>
            <p>Conseguir el contenido correcto es m√°s f√°cil que nunca.</p>
        </div>

        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>Dinos C√≥mo Te Sientes</h3>
                    <p>Selecciona tu estado emocional actual de nuestra rueda de √°nimos intuitiva. ¬øAnsioso? ¬øAburrido? ¬øAbrumado? Te tenemos.</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>Elige Tu Destino</h3>
                    <p>¬øD√≥nde quieres estar? ¬øRelajado? ¬øEnergizado? ¬øConcentrado? Elige tu estado deseado y d√©janos hacer el resto.</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>Disfruta Contenido Curado</h3>
                    <p>Recibe recomendaciones personalizadas de pel√≠culas, m√∫sica, podcasts y m√°s. Todo dise√±ado para llevarte del punto A al B.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ============ TESTIMONIALS ============ -->
<section class="testimonials" id="testimonials">
    <div class="section-header">
        <div class="section-tag">TESTIMONIOS</div>
        <h2>Lo Que Dicen Nuestros Usuarios</h2>
        <p>√önete a miles de mentes neurodivergentes encontrando su flow.</p>
    </div>

    <div class="testimonials-grid">
        <div class="testimonial-card">
            <p class="testimonial-text">"Por fin algo que entiende mi cerebro con TDAH. Antes pasaba 45 minutos eligiendo una pel√≠cula. Ahora toma 30 segundos."</p>
            <div class="testimonial-author">
                <div class="author-avatar">S</div>
                <div class="author-info">
                    <h4>Sara K.</h4>
                    <p>Creativa con TDAH</p>
                </div>
            </div>
        </div>

        <div class="testimonial-card">
            <p class="testimonial-text">"Mr.DP es como tener un amigo que siempre sabe lo que necesito. 'Me siento ansioso, necesito calma' ‚Äî playlist de lo-fi perfecta en segundos."</p>
            <div class="testimonial-author">
                <div class="author-avatar">M</div>
                <div class="author-info">
                    <h4>Marco T.</h4>
                    <p>Desarrollador de Software</p>
                </div>
            </div>
        </div>

        <div class="testimonial-card">
            <p class="testimonial-text">"Mi terapeuta me lo recomend√≥. Me ha ayudado a entender mis patrones emocionales y encontrar contenido saludable en vez de scrollear sin fin."</p>
            <div class="testimonial-author">
                <div class="author-avatar">J</div>
                <div class="author-info">
                    <h4>Julia L.</h4>
                    <p>Estudiante Universitaria</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ============ DOWNLOAD APP ============ -->
<section class="download-app" id="download">
    <div class="container">
        <div class="section-header">
            <div class="section-tag">üì± OBT√âN LA APP</div>
            <h2>Instala dopamine.watch</h2>
            <p>A√±√°dela a tu pantalla de inicio para la mejor experiencia ‚Äî ¬°funciona como una app nativa!</p>
        </div>

        <div class="download-grid">
            <div class="download-card">
                <div class="download-icon">üçé</div>
                <h3>iPhone / iPad</h3>
                <ol class="download-steps">
                    <li>Abre <strong>dopamine.watch</strong> en Safari</li>
                    <li>Toca el bot√≥n <strong>Compartir</strong> ‚¨ÜÔ∏è</li>
                    <li>Despl√°zate y toca <strong>"A√±adir a inicio"</strong></li>
                    <li>Toca <strong>A√±adir</strong> ‚Äî ¬°Listo! üéâ</li>
                </ol>
            </div>

            <div class="download-card">
                <div class="download-icon">ü§ñ</div>
                <h3>Android</h3>
                <ol class="download-steps">
                    <li>Abre <strong>dopamine.watch</strong> en Chrome</li>
                    <li>Toca el men√∫ <strong>‚ãÆ</strong> (arriba a la derecha)</li>
                    <li>Toca <strong>"Instalar app"</strong> o <strong>"A√±adir a inicio"</strong></li>
                    <li>Toca <strong>Instalar</strong> ‚Äî ¬°Listo! üéâ</li>
                </ol>
            </div>

            <div class="download-card">
                <div class="download-icon">üíª</div>
                <h3>Escritorio</h3>
                <ol class="download-steps">
                    <li>Abre <strong>dopamine.watch</strong> en Chrome/Edge</li>
                    <li>Haz clic en el <strong>√≠cono de instalar</strong> ‚äï en la barra</li>
                    <li>Haz clic en <strong>"Instalar"</strong></li>
                    <li>¬°La app aparece en tu dock! üéâ</li>
                </ol>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <a href="https://app.dopamine.watch" class="hero-btn primary" style="display: inline-block; text-decoration: none;">
                üöÄ Abrir App Ahora
            </a>
        </div>
    </div>
</section>

<!-- ============ PRICING ============ -->
<section class="pricing" id="pricing">
    <div class="container">
        <div class="section-header">
            <div class="section-tag">PRECIOS</div>
            <h2>Precios Simples y Transparentes</h2>
            <p>Comienza gratis. Mejora cuando est√©s listo.</p>
        </div>

        <div class="pricing-grid" style="max-width: 700px; margin: 60px auto 0;">
            <div class="pricing-card">
                <h3>Gratis</h3>
                <div class="pricing-price">$0<span>/siempre</span></div>
                <ul class="pricing-features">
                    <li>Descubrimiento por √°nimo</li>
                    <li>Chute R√°pido</li>
                    <li>Todos los tipos de contenido (Pelis, M√∫sica, Podcasts, Audiolibros, Shorts)</li>
                    <li>5 chats con Mr.DP</li>
                    <li>Seguimiento de Puntos Dopamina</li>
                </ul>
                <button class="pricing-btn secondary" onclick="openModal('signup')">Comenzar Gratis</button>
            </div>

            <div class="pricing-card featured">
                <div class="pricing-badge">RECOMENDADO</div>
                <h3>Premium</h3>
                <div class="pricing-price">$4.99<span>/mes</span></div>
                <ul class="pricing-features">
                    <li>Todo lo de Gratis</li>
                    <li>Chats ilimitados con Mr.DP</li>
                    <li>Sin anuncios</li>
                    <li>Recomendaciones IA prioritarias</li>
                    <li>Insignia exclusiva üíé</li>
                    <li>Acceso anticipado a nuevas funciones</li>
                </ul>
                <button class="pricing-btn primary" onclick="openModal('signup')">Ir Premium</button>
            </div>
        </div>
    </div>
</section>

<!-- ============ CTA ============ -->
<section class="cta">
    <div class="cta-box">
        <h2>¬øListo para Dominar Tu Dopamina?</h2>
        <p>√önete a miles de mentes neurodivergentes encontrando su flow. Comienza gratis, sin tarjeta de cr√©dito.</p>
        <button class="hero-btn primary" onclick="openModal('signup')">üöÄ Comenzar Gratis</button>
    </div>
</section>

<!-- ============ FOOTER ============ -->
<footer>
    <div class="footer-links">
        <a href="https://www.dopamine.watch/privacidad.html">Privacidad</a>
        <a href="https://www.dopamine.watch/terminos.html">T√©rminos</a>
        <a href="mailto:hola@dopamine.watch">Contacto</a>
        <a href="https://twitter.com/dopaminewatch" target="_blank">Twitter</a>
        <span style="opacity:0.3">|</span>
        <a href="https://www.dopamine.watch/index.html">üá∫üá∏ EN</a>
        <a href="https://www.dopamine.watch/index_es.html">üá™üá∏ ES</a>
    </div>
    <p class="footer-copy">¬© 2026 Dopamine.watch. Hecho con üß† para mentes neurodivergentes.</p>
</footer>

<!-- ============ MR.DP FLOATING CHAT WIDGET ============ -->
<div class="mr-dp-container" id="mrDpContainer">
    <div class="mr-dp-popup" id="mrDpPopup">
        <div class="mr-dp-header">
            <div class="mr-dp-header-img" id="mrDpHeaderImg"></div>
            <div>
                <div class="mr-dp-header-name">Mr.DP</div>
                <div class="mr-dp-header-status">‚óè En l√≠nea - Tu Amigo de Dopamina</div>
            </div>
        </div>
        <div class="mr-dp-messages" id="mrDpMessages">
            <div class="mr-dp-empty">
                <div class="mr-dp-empty-icon">üß†</div>
                <div>¬°Hola! Soy Mr.DP. Cu√©ntame c√≥mo te sientes y encontrar√© el contenido perfecto para ti.</div>
            </div>
        </div>
        <div class="mr-dp-input-area">
            <input type="text" class="mr-dp-input" id="mrDpInput" placeholder="¬øC√≥mo te sientes?" />
            <button class="mr-dp-send" id="mrDpSend" onclick="sendMrDpMessage()">Enviar</button>
        </div>
    </div>

    <div class="mr-dp-avatar" onclick="toggleMrDp()" title="Chatea con Mr.DP" role="button" tabindex="0" id="mrDpAvatar">
        <!-- SVG inserted by JavaScript -->
    </div>
</div>

<!-- ============ AUTH MODAL ============ -->
<div class="modal-overlay" id="authModal">
    <div class="modal">
        <button class="modal-close" onclick="closeModal()">√ó</button>

        <!-- LOGIN SCREEN -->
        <div class="auth-screen active" id="loginScreen">
            <div class="auth-title">¬°Bienvenido de Nuevo!</div>
            <div class="auth-subtitle">Inicia sesi√≥n en tu motor de dopamina</div>

            <!-- Google Sign-In Button -->
            <div id="g_id_onload"
                 data-client_id="774493038206-10a3vcpttdil6otb9ti2q4q5ponc8hok.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="handleGoogleSignIn"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="filled_black"
                 data-text="signin_with"
                 data-size="large"
                 data-logo_alignment="left"
                 data-width="100%">
            </div>

            <div class="auth-divider">
                <span>o contin√∫a con email</span>
            </div>

            <div class="form-group">
                <label>Email o ID de Dopamina</label>
                <input type="text" id="login-email" placeholder="tu@email.com">
            </div>

            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>

            <button class="auth-btn" onclick="handleLogin()">üîê Iniciar Sesi√≥n</button>
            <button class="auth-btn secondary" onclick="guestAccess()">üë§ Continuar como Invitado</button>

            <div class="auth-link">
                <a onclick="showScreen('forgot')">¬øOlvidaste tu contrase√±a?</a>
            </div>
            <div class="auth-link">
                ¬øNo tienes cuenta? <a onclick="showScreen('signup')">Reg√≠strate</a>
            </div>
        </div>

        <!-- FORGOT PASSWORD SCREEN -->
        <div class="auth-screen" id="forgotScreen">
            <div class="auth-title">Restablecer Contrase√±a</div>
            <div class="auth-subtitle">Ingresa tu email para recibir un enlace</div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="forgot-email" placeholder="tu@email.com">
            </div>

            <button class="auth-btn" onclick="handleForgotPassword()">üìß Enviar Enlace</button>
            <button class="auth-btn secondary" onclick="showScreen('login')">‚Üê Volver a Inicio</button>
        </div>

        <!-- SIGNUP SCREEN -->
        <div class="auth-screen" id="signupScreen">
            <div class="auth-title">Crear Cuenta</div>
            <div class="auth-subtitle">Comienza tu viaje de dopamina</div>

            <!-- Google Sign-In Button for Signup -->
            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="filled_black"
                 data-text="signup_with"
                 data-size="large"
                 data-logo_alignment="left"
                 data-width="100%">
            </div>

            <div class="auth-divider">
                <span>o reg√≠strate con email</span>
            </div>

            <div class="form-group">
                <label>ID de Dopamina (usuario)</label>
                <input type="text" id="signup-username" placeholder="TuNombre123">
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signup-email" placeholder="tu@email.com">
            </div>

            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="signup-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ (m√≠n. 6 caracteres)">
            </div>

            <button class="auth-btn" onclick="handleSignup()">üöÄ Crear Cuenta</button>
            <button class="auth-btn secondary" onclick="guestAccess()">üë§ Continuar como Invitado</button>

            <div class="auth-link">
                ¬øYa tienes cuenta? <a onclick="showScreen('login')">Iniciar Sesi√≥n</a>
            </div>
        </div>
    </div>
</div>

<script>
// ============================================
// CONFIGURATION
// ============================================
const STREAMLIT_APP_URL = "https://app.dopamine.watch";

// Supabase Configuration
const SUPABASE_URL = "https://wkfewpynskakgbetscsa.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrZmV3cHluc2tha2diZXRzY3NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MDcwMTAsImV4cCI6MjA4MzQ4MzAxMH0.DXnSsvabfwfNZIJaP0UR39YQe_3CHW-RjL2o1vDsunQ";

// Initialize Supabase only when available
let supabaseClient = null;
function initSupabase() {
    if (window.supabase && !supabaseClient) {
        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    }
    return supabaseClient;
}

// ============================================
// MR.DP DYNAMIC SVG GENERATION
// ============================================
function getMrDpSvg(expression = 'happy') {
    const expressions = {
        happy: { leftEye: '‚ó†', rightEye: '‚ó†', mouth: 'smile', blush: true },
        thinking: { leftEye: '‚Ä¢', rightEye: '‚Ä¢', mouth: 'hmm', blush: false },
        excited: { leftEye: '‚òÖ', rightEye: '‚òÖ', mouth: 'big_smile', blush: true },
        empathetic: { leftEye: '‚ó†', rightEye: '‚ó†', mouth: 'soft_smile', blush: true },
        curious: { leftEye: '‚óã', rightEye: '‚óã', mouth: 'o', blush: false },
        wink: { leftEye: '‚ó†', rightEye: '‚àí', mouth: 'smile', blush: true }
    };

    const expr = expressions[expression] || expressions.happy;

    const mouths = {
        smile: '<path d="M24 38 Q32 46 40 38" stroke="#ff6b9d" stroke-width="3" fill="none" stroke-linecap="round"/>',
        big_smile: '<path d="M22 36 Q32 48 42 36" stroke="#ff6b9d" stroke-width="3" fill="none" stroke-linecap="round"/><path d="M26 40 Q32 44 38 40" fill="#ff6b9d"/>',
        soft_smile: '<path d="M26 38 Q32 43 38 38" stroke="#ff6b9d" stroke-width="2.5" fill="none" stroke-linecap="round"/>',
        hmm: '<path d="M26 40 L38 38" stroke="#ff6b9d" stroke-width="2.5" fill="none" stroke-linecap="round"/>',
        o: '<circle cx="32" cy="40" r="4" fill="#ff6b9d"/>'
    };

    const blush = expr.blush ? '<circle cx="18" cy="36" r="5" fill="#ff6b9d" opacity="0.3"/><circle cx="46" cy="36" r="5" fill="#ff6b9d" opacity="0.3"/>' : '';

    return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
<defs>
<linearGradient id="ng" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" style="stop-color:#a78bfa"/>
<stop offset="50%" style="stop-color:#8b5cf6"/>
<stop offset="100%" style="stop-color:#7c3aed"/>
</linearGradient>
<linearGradient id="ag" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" style="stop-color:#8b5cf6"/>
<stop offset="100%" style="stop-color:#06b6d4"/>
</linearGradient>
</defs>
<g>
<path d="M32 12 Q28 4 20 2" stroke="url(#ag)" stroke-width="3" fill="none" stroke-linecap="round"/>
<circle cx="20" cy="2" r="3" fill="#06b6d4"/>
<path d="M32 12 Q36 4 44 2" stroke="url(#ag)" stroke-width="3" fill="none" stroke-linecap="round"/>
<circle cx="44" cy="2" r="3" fill="#06b6d4"/>
<path d="M32 12 Q32 6 32 0" stroke="url(#ag)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
<circle cx="32" cy="0" r="2.5" fill="#10b981"/>
<path d="M12 28 Q4 24 0 20" stroke="url(#ag)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
<circle cx="0" cy="20" r="2.5" fill="#f59e0b"/>
<path d="M52 28 Q60 24 64 20" stroke="url(#ag)" stroke-width="2.5" fill="none" stroke-linecap="round"/>
<circle cx="64" cy="20" r="2.5" fill="#f59e0b"/>
</g>
<path d="M32 52 Q32 58 28 62" stroke="url(#ag)" stroke-width="4" fill="none" stroke-linecap="round"/>
<circle cx="28" cy="62" r="3" fill="#10b981"/>
<ellipse cx="32" cy="32" rx="22" ry="20" fill="url(#ng)"/>
<ellipse cx="26" cy="24" rx="8" ry="5" fill="white" opacity="0.3"/>
<text x="22" y="32" font-size="10" fill="white" text-anchor="middle" font-family="Arial">${expr.leftEye}</text>
<text x="42" y="32" font-size="10" fill="white" text-anchor="middle" font-family="Arial">${expr.rightEye}</text>
<path d="M18 24 Q22 22 26 24" stroke="white" stroke-width="1.5" fill="none" opacity="0.8"/>
<path d="M38 24 Q42 22 46 24" stroke="white" stroke-width="1.5" fill="none" opacity="0.8"/>
${mouths[expr.mouth]}
${blush}
<text x="54" y="14" font-size="8" fill="#ffd700" opacity="0.8">‚ú¶</text>
<text x="8" y="18" font-size="6" fill="#ffd700" opacity="0.6">‚ú¶</text>
</svg>`;
}

function initMrDp() {
    const avatar = document.getElementById('mrDpAvatar');
    const headerImg = document.getElementById('mrDpHeaderImg');
    const svg = getMrDpSvg('happy');
    avatar.innerHTML = svg;
    headerImg.innerHTML = svg;
}

function toggleMrDp() {
    const popup = document.getElementById('mrDpPopup');
    popup.classList.toggle('open');
    if (popup.classList.contains('open')) {
        const msgs = document.getElementById('mrDpMessages');
        if (msgs) msgs.scrollTop = msgs.scrollHeight;
        document.getElementById('mrDpInput').focus();
    }
}

function setMrDpExpression(expression) {
    const avatar = document.getElementById('mrDpAvatar');
    const headerImg = document.getElementById('mrDpHeaderImg');
    const svg = getMrDpSvg(expression);
    avatar.innerHTML = svg;
    headerImg.innerHTML = svg;
}

// ============================================
// MR.DP CHAT FUNCTIONALITY (AI-Powered - Spanish)
// ============================================
const MR_DP_API = SUPABASE_URL + '/functions/v1/mr-dp-chat';
let mrDpHistory = [];

async function sendMrDpMessage() {
    const input = document.getElementById('mrDpInput');
    const sendBtn = document.getElementById('mrDpSend');
    const message = input.value.trim();

    if (!message) return;

    // Add user message
    addMrDpMessage(message, 'user');
    mrDpHistory.push({ role: 'user', content: message });
    input.value = '';

    // Disable input while processing
    input.disabled = true;
    sendBtn.disabled = true;
    setMrDpExpression('thinking');

    try {
        const response = await fetch(MR_DP_API, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
            },
            body: JSON.stringify({
                message: message,
                history: mrDpHistory.slice(-6),
                lang: 'es'
            })
        });

        const data = await response.json();
        const aiResponse = data.response || "Hmm, estoy teniendo un momento. ¬øIntentamos de nuevo? üíú";

        addMrDpMessage(aiResponse, 'assistant');
        mrDpHistory.push({ role: 'assistant', content: aiResponse });
        setMrDpExpression(data.fallback ? 'empathetic' : 'happy');

    } catch (error) {
        console.error('Mr.DP error:', error);
        const fallback = getLocalFallback(message);
        addMrDpMessage(fallback, 'assistant');
        setMrDpExpression('empathetic');
    }

    // Re-enable input
    input.disabled = false;
    sendBtn.disabled = false;
    input.focus();
}

function getLocalFallback(msg) {
    msg = msg.toLowerCase();
    if (msg.match(/(hola|hey|buenas)/)) return "¬°Hola! üëã Soy Mr.DP. Problemas de conexi√≥n pero aqu√≠ estoy. ¬°Reg√≠strate gratis para mis poderes completos!";
    if (msg.match(/(ansioso|ansiedad|estresado|abrumado)/)) return "Te escucho üíú Reg√≠strate y puedo encontrar contenido relajante perfecto para esa ansiedad.";
    if (msg.match(/(aburrido|cansado|agotado)/)) return "¬°Esa sensaci√≥n de falta de est√≠mulo es horrible! Soy bueno encontrando contenido perfecto. ¬°Reg√≠strate gratis! üéØ";
    if (msg.match(/(precio|costo|gratis|premium)/)) return "Plan gratis = todo + 5 chats diarios conmigo. Premium ($4.99/mes) = Mr.DP ilimitado + sin anuncios üíé";
    if (msg.match(/(tdah|neurodivergente)/)) return "¬°Hecho POR neurodivergentes PARA neurodivergentes! Entendemos la fatiga de decisi√≥n. Un bot√≥n = contenido perfecto üß†";
    return "¬°Me encantar√≠a ayudarte m√°s! Reg√≠strate gratis y podr√© usar mis poderes completos de IA üöÄ";
}

function addMrDpMessage(text, role) {
    const messagesContainer = document.getElementById('mrDpMessages');

    // Remove empty state if exists
    const empty = messagesContainer.querySelector('.mr-dp-empty');
    if (empty) empty.remove();

    // Create message element
    const msg = document.createElement('div');
    msg.className = `mr-dp-msg ${role}`;
    msg.textContent = text;

    messagesContainer.appendChild(msg);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Enter key support for Mr.DP chat
document.addEventListener('DOMContentLoaded', function() {
    initMrDp();

    const input = document.getElementById('mrDpInput');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMrDpMessage();
            }
        });
    }
});

// ============================================
// GOOGLE SIGN-IN HANDLER
// ============================================
function handleGoogleSignIn(response) {
    const credential = response.credential;
    const payload = JSON.parse(atob(credential.split('.')[1]));

    const user = {
        email: payload.email,
        name: payload.name || payload.email.split('@')[0],
        picture: payload.picture,
        googleId: payload.sub,
        loggedIn: true,
        isGoogleUser: true,
        timestamp: Date.now()
    };

    localStorage.setItem('dopamine_user', JSON.stringify(user));

    closeModal();
    window.location.href = STREAMLIT_APP_URL + '?user=' + encodeURIComponent(user.name) + '&google=1';
}

// ============================================
// AUTH MODAL CONTROLS
// ============================================
function openModal(screen) {
    document.getElementById('authModal').classList.add('active');
    showScreen(screen);
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    document.getElementById('authModal').classList.remove('active');
    document.body.style.overflow = '';
    document.querySelectorAll('.modal input').forEach(i => i.value = '');
}

function showScreen(screen) {
    document.querySelectorAll('.auth-screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screen + 'Screen').classList.add('active');
}

async function handleLogin() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;

    if (!email || !password) {
        alert('Por favor ingresa email y contrase√±a');
        return;
    }

    const sb = initSupabase();
    if (!sb) {
        alert('Servicio de autenticaci√≥n cargando. Intenta de nuevo.');
        return;
    }

    const btn = document.querySelector('#loginScreen .auth-btn');
    const originalText = btn.textContent;
    btn.textContent = 'Iniciando sesi√≥n...';
    btn.disabled = true;

    try {
        const { data, error } = await sb.auth.signInWithPassword({
            email: email,
            password: password
        });

        if (error) {
            alert('Error al iniciar sesi√≥n: ' + error.message);
            btn.textContent = originalText;
            btn.disabled = false;
            return;
        }

        const user = {
            id: data.user.id,
            email: data.user.email,
            name: data.user.email.split('@')[0],
            loggedIn: true,
            timestamp: Date.now()
        };
        localStorage.setItem('dopamine_user', JSON.stringify(user));

        window.location.href = STREAMLIT_APP_URL + '?user=' + encodeURIComponent(user.name);
    } catch (err) {
        alert('Error de login: ' + err.message);
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

async function handleSignup() {
    const username = document.getElementById('signup-username').value.trim();
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value;

    if (!username || !email || !password) {
        alert('Por favor completa todos los campos');
        return;
    }

    if (password.length < 6) {
        alert('La contrase√±a debe tener al menos 6 caracteres');
        return;
    }

    const sb = initSupabase();
    if (!sb) {
        alert('Servicio de autenticaci√≥n cargando. Intenta de nuevo.');
        return;
    }

    const btn = document.querySelector('#signupScreen .auth-btn');
    const originalText = btn.textContent;
    btn.textContent = 'Creando cuenta...';
    btn.disabled = true;

    try {
        const { data, error } = await sb.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    name: username
                }
            }
        });

        if (error) {
            alert('Error al registrarse: ' + error.message);
            btn.textContent = originalText;
            btn.disabled = false;
            return;
        }

        if (data.user) {
            await sb.from('profiles').upsert({
                id: data.user.id,
                email: email,
                name: username,
                mr_dp_uses: 0,
                is_premium: false
            });
        }

        const user = {
            id: data.user?.id,
            email: email,
            name: username,
            loggedIn: true,
            timestamp: Date.now(),
            isNew: true
        };
        localStorage.setItem('dopamine_user', JSON.stringify(user));

        if (data.user && !data.session) {
            alert('¬°Cuenta creada! Revisa tu email para verificar tu cuenta.');
            showScreen('login');
            btn.textContent = originalText;
            btn.disabled = false;
        } else {
            window.location.href = STREAMLIT_APP_URL + '?user=' + encodeURIComponent(username) + '&new=1';
        }
    } catch (err) {
        alert('Error de registro: ' + err.message);
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

function guestAccess() {
    const user = {
        email: 'guest@dopamine.watch',
        name: 'Invitado',
        loggedIn: true,
        isGuest: true,
        timestamp: Date.now()
    };
    localStorage.setItem('dopamine_user', JSON.stringify(user));
    window.location.href = STREAMLIT_APP_URL + '?guest=1';
}

async function handleForgotPassword() {
    const email = document.getElementById('forgot-email').value.trim();

    if (!email) {
        alert('Por favor ingresa tu email');
        return;
    }

    if (!email.includes('@')) {
        alert('Por favor ingresa un email v√°lido');
        return;
    }

    const sb = initSupabase();
    if (!sb) {
        alert('Servicio de autenticaci√≥n cargando. Intenta de nuevo.');
        return;
    }

    const btn = document.querySelector('#forgotScreen .auth-btn');
    const originalText = btn.textContent;
    btn.textContent = 'Enviando...';
    btn.disabled = true;

    try {
        const { error } = await sb.auth.resetPasswordForEmail(email, {
            redirectTo: STREAMLIT_APP_URL + '?reset=1'
        });

        if (error) {
            alert('Error: ' + error.message);
            btn.textContent = originalText;
            btn.disabled = false;
            return;
        }

        alert('¬°Email de recuperaci√≥n enviado! Revisa tu bandeja: ' + email);
        showScreen('login');
        btn.textContent = originalText;
        btn.disabled = false;
    } catch (err) {
        alert('Error al enviar email: ' + err.message);
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeModal();
        if (document.getElementById('mrDpPopup').classList.contains('open')) {
            toggleMrDp();
        }
    }
});

// Close modal on overlay click
document.getElementById('authModal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

// Enter key support for auth forms
document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && document.getElementById('authModal').classList.contains('active')) {
        const loginScreen = document.getElementById('loginScreen');
        const signupScreen = document.getElementById('signupScreen');

        if (loginScreen.classList.contains('active')) {
            handleLogin();
        } else if (signupScreen.classList.contains('active')) {
            handleSignup();
        }
    }
});

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    initMrDp();
});
</script>
</body>
</html>
